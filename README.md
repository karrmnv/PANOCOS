# PANOCOS
Проект создан для формирования окна просмотра панорамы из кадров неподвижной мультикамерной сборки. В качестве исходного изображения могут быть использованы видеопотоки от нескольких камер имеющих немного отличающиеся коорданаты. Панорамой считатаем суммарное изображение формируемое специальными алгоритмами, которые на вход получают изоюражения с имеющихся камер из сборки и на выходе формируют изображение покрывающее область видимости всех камер. Под окном панорамы подразумевается изображение формируемое только из интересующей части панорамы. Основное практическое применение данного проекта - объекты транспорта (аэропорты, железнодорожные станции, морские и речные порты). 

## Содержание
В проекте представлена библиотека функций (исходный код лежит в файле functions.py). Программист системы окна просмотра панорамы может использовать эти функции для формирования панорамы из камер с пересекающимся углом обзора или формирования окна просмотра панорамы без предварительного формирования всей панорамы с последующим выводом окна панорамы на экран пользователя отличающегося размером от окна панорамы. Данные функции работают с путем на изображения в формате подходящим для чтения изображений с помощью функции imread() из OpenCV либо с ссылками на изображения в формате OpenCV. Для получения ссылки на изображение в формате OpenCV можно преобразовать(например с помощью утилиты ffmpeg) видеопотоки в файлы jpg формата(или любого другого формата подходящего для чтения изображений с помощью функций из OpenCV), и загрузить эти файлы с помощью функции imread() из библиотеки OpenCV.

### Функции для формирования окна просмотра панорамы:
+ make_display_frames() $-$ формирует изображение окна просмотра панорамы для нескольких кадров(номера кадров и путь до папки с изображениями подаются на вход)
  + make_display() $-$ формирует изображение окна просмотра панорамы нужной области для одного кадра(без сглаживания шва при сшифки изображений)
    + cut_area() $-$ находит координаты зоны пересечения двух областей на панораме, применяется для нахождения зоны пересечения координат окна панорамы и изображений с каждой камеры
    + resized_image() $-$ меняет размер изображений с камер под размер экрана пользователя
 


### Функции для выравнивания соседних изображений:
+ homografy() $-$ на вход подаются ссылки двух изображений, возвращает матрицу преобразования H (поворот и сдвиг) для второго изображения
+  rotate() $-$ на вход получает изображение и матрицу преобразования H для этого изображения, возвращает матрицу преобразования без сдвига и размер преобразованного изображения
+ rotate_and_cut() $-$ аналогична функции rotate() возвращает матрицу преобразования и размер изображения чтобы отрезать углы на изображении появившиеся из-за поворота
  Зная матрицу преобразования для изображения, преобразовываем его с помощью функции warpAffine() из OpenCV. И зная сдвиги поверутых изображений относительно друг друга мы можем ввести систему координат для панорамы где у каждого изображения будут свои координаты в этой системе (например будем хранить для каждого изображения координаты верхнего левого угла, ширину и высоту).

  

### Функции для выравнивания яркости соседних сшиваемых изображений:
+ return_W() $-$ на вход принимает координаты соседних изображений в единой системе координат, возвращает веса для функций преобразования яркости для каждого пикселя на втором изображении
  + ret_weights() $-$ на вход подается координата пикселя на изображении и координаты точек в которых будут ситаться функции преобразования яркости, возвращает веса функций для требуемого пикселя
    +  weights() $-$ на вход принимает расстояния от пикселя до точек в которых будут ситаться функции преобразования яркости, возвращает веса(обратнопропорционально расстоянию)
+ brightness_correction() $-$ на вход получает ссылки двух соседних изображений, делает коррекцию яркости второго изображения
  + cut_area() $-$ находит координаты зоны пересечения двух областей на панораме, применяется для нахождения зоны пересечения двух соседних изображений
  + ret_functions() $-$ находит функции преобразования яркости с помощью функции find_correction() для 3 областей на зоне пересечения изображений с соседних камер
    + find_correction() $-$ находит функцию преобразования яркости для соответсвующей области на соседних изображениях


## Руководство пользователя
* пример применения функций для формирования окна просмора панорамы представлен в ноутбуке make_display.ipynb
* пример применения функций для вырвнивания соседних изображений для 4 камер расположенных в ряд горизонтально представлен в ноутбуке Rotate_and_cut_PANOCOS2.ipynb
* пример применения функций для выравнивания яркости соседних сшиваемых изображений представлен для 4 камер расположенных в ряд горизонтально представлен в ноутбуке brightness_correction.ipynb

## Для работы библиотеки необходима установка следующих пакетов:
* установить Python по инструкции по **[ccылке](https://www.python.org/downloads/)**
* установить NumPy по инструкции по **[ссылке](https://numpy.org)**
* установить OpenCV по иснтрукции по **[ссылке](https://opencv.org/releases/)**
